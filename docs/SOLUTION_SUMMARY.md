# –†–µ—à–µ–Ω–∏–µ: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ª–∏—Ü–æ–º –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Hikvision

## ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ (–ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û –ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û)

**–ú–µ—Ç–æ–¥:** `CaptureFaceData` ‚Üí `UserInfo/Record` ‚Üí `FDSetUp`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å —Ñ–æ—Ç–æ –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ!

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

1. **CaptureFaceData** (`POST /ISAPI/AccessControl/CaptureFaceData`)
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–µ–∂–∏–º –∑–∞—Ö–≤–∞—Ç–∞ –ª–∏—Ü–∞ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç –ª–∏—Ü–æ –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É
   - –¢–µ—Ä–º–∏–Ω–∞–ª —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `web_face_enrollpic.jpg` –≤ `/LOCALS/pic/`
   - –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ URL: `https://192.168.1.67/LOCALS/pic/web_face_enrollpic.jpg@WEB000000000020`

2. **UserInfo/Record** (`POST /ISAPI/AccessControl/UserInfo/Record`)
   - –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
   - **–ö–†–ò–¢–ò–ß–ù–û:** –í–∫–ª—é—á–∞–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
     - `doorRight: "1"` - –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–≤–µ—Ä—è–º
     - `RightPlan` —Å `planTemplateNo: "1"` - —à–∞–±–ª–æ–Ω –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
     - `groupId: 1` - –≥—Ä—É–ø–ø–∞ –¥–æ—Å—Ç—É–ø–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

3. **FDSetUp** (`PUT /ISAPI/Intelligent/FDLib/FDSetUp`)
   - –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π URL —Ç–µ—Ä–º–∏–Ω–∞–ª–∞: `web_face_enrollpic.jpg`

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- –§–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è **–Ω–∞ —Å–∞–º–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ** —á–µ—Ä–µ–∑ `CaptureFaceData`
- `FDSetUp` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π URL —Ç–µ—Ä–º–∏–Ω–∞–ª–∞** (–Ω–µ –≤–Ω–µ—à–Ω–∏–π)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç **–≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è** –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## ‚ùå –ù–µ—Ä–∞–±–æ—á–∏–µ –º–µ—Ç–æ–¥—ã (—É–¥–∞–ª–µ–Ω—ã –∏–∑ –∫–æ–¥–∞)

1. **pictureUpload** - `POST /ISAPI/Intelligent/FDLib/pictureUpload`
   - –û—à–∏–±–∫–∞: `"notSupport"` (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º)

2. **FaceDataRecord —Å URL** - `POST /ISAPI/Intelligent/FDLib/FaceDataRecord` —Å –≤–Ω–µ—à–Ω–∏–º URL
   - –û—à–∏–±–∫–∞: `"urlDownloadFail"` (—Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ –ø–æ –≤–Ω–µ—à–Ω–µ–º—É URL)

3. **FaceDataRecord —Å base64** - `POST /ISAPI/Intelligent/FDLib/FaceDataRecord` —Å base64
   - –û—à–∏–±–∫–∞: `"badJsonContent"` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

4. **FaceDataRecord —Å –±–∏–Ω–∞—Ä–Ω—ã–º —Ñ–æ—Ç–æ** - `POST /ISAPI/Intelligent/FDLib/FaceDataRecord` —Å multipart
   - –û—à–∏–±–∫–∞: `"badJsonFormat"` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

5. **–ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ /LOCALS/** - `PUT /LOCALS/pic/enrlFace/0/{id}.jpg`
   - –û—à–∏–±–∫–∞: `405 Method Not Allowed` (PUT –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

6. **create_user_with_face_on_terminal()** - —É–¥–∞–ª–µ–Ω (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
7. **create_user_with_face_url()** - —É–¥–∞–ª–µ–Ω (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

## üìù –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ `hikvision_client.py`:

- `create_user_basic()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `start_face_capture_mode()` - –∑–∞—Ö–≤–∞—Ç —Ñ–æ—Ç–æ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
- `setup_user_face_fdlib()` - –ø—Ä–∏–≤—è–∑–∫–∞ —Ñ–æ—Ç–æ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```json
{
  "UserInfo": {
    "employeeNo": "100222",
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "userType": "normal",
    "doorRight": "1",                    // –ö–†–ò–¢–ò–ß–ù–û: –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
    "RightPlan": [                       // –ö–†–ò–¢–ò–ß–ù–û: —à–∞–±–ª–æ–Ω –ø—Ä–∞–≤
      {
        "doorNo": 1,
        "planTemplateNo": "1"
      }
    ],
    "groupId": 1,                        // –ö–†–ò–¢–ò–ß–ù–û: –≥—Ä—É–ø–ø–∞ –¥–æ—Å—Ç—É–ø–∞
    "Valid": {
      "enable": true,
      "beginTime": "2025-12-11T00:00:00",
      "endTime": "2035-12-10T23:59:59",
      "timeType": "local"
    }
  }
}
```

**–ë–µ–∑ —ç—Ç–∏—Ö –ø–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é!**

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î**
   - `POST /api/users/` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

2. **–ó–∞—Ö–≤–∞—Ç —Ñ–æ—Ç–æ —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞**
   - `POST /api/devices/{id}/start-face-capture` - –∑–∞–ø—É—Å–∫ –∑–∞—Ö–≤–∞—Ç–∞
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç –ª–∏—Ü–æ –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É
   - –¢–µ—Ä–º–∏–Ω–∞–ª —Å–æ–∑–¥–∞–µ—Ç `web_face_enrollpic.jpg`

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º**
   - `POST /api/users/{id}/sync-to-device`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
   - –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ `FDSetUp` —Å URL `web_face_enrollpic.jpg`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢!** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º —Ñ–æ—Ç–æ –∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞, —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é!

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **ISAPI_USER_REGISTRATION_GUIDE.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ISAPI
- **USER_CREATION_GUIDE.md** - –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **AUTHENTICATION_FIX.md** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

---

**–í–µ—Ä—Å–∏—è:** 2.0 (Production Ready)  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-01-10  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production

